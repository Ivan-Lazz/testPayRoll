# Enable rewriting engine
RewriteEngine On
RewriteBase /testPayRoll/

# Deny access to files starting with a dot
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Deny access to config files
<FilesMatch "^config\.php$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protect against XSS, clickjacking and other vulnerabilities

# CORS Headers
<IfModule mod_headers.c>
    # Ensure we're not duplicating headers by removing any existing ones first
    Header unset Access-Control-Allow-Origin
    Header unset Access-Control-Allow-Methods
    Header unset Access-Control-Allow-Headers
    
    # Now set them once
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With, X-CSRF-Token"
    
    # Handle preflight OPTIONS requests
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# Redirect all API requests to index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^api/(.*)$ index.php [QSA,L]

# Set default character set
AddDefaultCharset UTF-8

# Disable directory listing
Options -Indexes

# Prevent access to specific file types
<FilesMatch "\.(ini|log|sh|sql|json)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# PHP settings
php_flag display_errors on
php_flag log_errors on
php_value error_log "error_log.txt"
php_value max_execution_time 30
php_value max_input_time 60
php_value memory_limit 128M
php_value post_max_size 8M
php_value upload_max_filesize 2M